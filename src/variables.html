<link rel="stylesheet" href="src/variablesStyles.css">
<link rel="stylesheet" href="src/libs/mathlive-master/dist/mathlive.core.css">
<link rel="stylesheet" href="src/libs/mathlive-master/dist/mathlive.css">
<link href="src/libs/iCheck/skins/flat/green.css" rel="stylesheet">
<link href="src/libs/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
<link href="src/libs/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
<link href="src/libs/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
<link href="src/libs/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
<link href="src/libs/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">
<link href="src/libs/bootstrap-datepicker/datepicker3.css" rel="stylesheet">
<link href="src/libs/overhang/overhang.min.css" rel="stylesheet">
<link href="src/libs/custom.min.css" rel="stylesheet">
<!-- page content -->
<div>
  <div class="page-title">
    <div class="title_left">
      <h3>Editar Variables </h3>
    </div>

    <!-- <div class="title_right">
      <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
        <div class="input-group">
          <input id="buscarDiv" type="text" class="form-control" placeholder="Buscar...">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button" onclick="filterDiv()">Filtrar</button>
          </span>
        </div>
      </div>
    </div> -->
  </div>
  
  <div class="clearfix"></div>

  <div id="formula_div" class="row filtrarRow">
    <div class="col-md-12">
      <div class="x_panel">
        <div class="x_title">
          <h2>Formula del Ratio de Cobertura de Liquidez</h2>
          <ul class="nav navbar-right panel_toolbox">
            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
            </li>
          </ul>
          <div class="clearfix"></div>
        </div>

        <div class="x_content">

          <div class="col-md-9 col-sm-8 col-xs-12">
            <div id="contenedorTextoVariables">
            </div>
            <br/>
            <h5>* Nota: Las variables son insensibles a may&uacute;sculas y min&uacute;sculas.</h5>
            <br/>
            <h4>Ingresar Formula RCL:</h4>
            <br/>
            <div id="wrapper">
              <div id="salida" class="formula_style">
              </div>
            </div>
            <div class="ln_solid"></div>
            <div id="wrapper">
              <button onclick="resetFormula()" type="button" class="btn btn-info">Resetear</button>
              <button id="mostrar" onclick="saveFormula()" type="button" class="btn btn-success">Guardar</button>
            </div>

          </div>

          <!-- start project-detail sidebar -->
          <div class="col-md-3 col-sm-4 col-xs-12">

            <section class="panel">

              <div class="x_title">
                <h3 class="green"><i class="fa fa-flag-checkered"></i> Comandos</h3>
                <div class="clearfix"></div>
              </div>
              <div class="panel-body">

                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>Nombre</th>
                      <th>S&iacute;mbolo</th>
                      <th>Teclas</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Suma</td>
                      <td>2+x</td>
                      <td>+</td>
                    </tr>
                    <tr>
                      <td>Resta</td>
                      <td>2-x</td>
                      <td>-</td>
                    </tr>
                    <tr>
                      <td>Multiplicaci&oacute;n</td>
                      <td>2*x</td>
                      <td>xx</td>
                    </tr>
                    <tr>
                      <td>Divisi&oacute;n</td>
                      <td>&frac14;</td>
                      <td>/</td>
                    </tr>
                    <tr>
                      <td>Exponencial</td>
                      <td>2 <sup>x</sup> </td>
                      <td>^</td>
                    </tr>
                    <tr>
                      <td>Sumatoria</td>
                      <td>&Sigma;</td>
                      <td>sum</td>
                    </tr>
                    <tr>
                      <td>No Igual</td>
                      <td>&#8800;</td>
                      <td>!=</td>
                    </tr>
                    <tr>
                      <td>Igual</td>
                      <td>=</td>
                      <td>=</td>
                    </tr>
                    <tr>
                      <td>Menor</td>
                      <td>&#60;</td>
                      <td>&#60;</td>
                    </tr>
                    <tr>
                      <td>Mayor</td>
                      <td>&#62;</td>
                      <td>&#62;</td>
                    </tr>
                    <tr>
                      <td>Menor &oacute; Igual</td>
                      <td>&le;</td>
                      <td>&#60;=</td>
                    </tr>
                    <tr>
                      <td>Mayor &oacute; Igual</td>
                      <td>&ge;</td>
                      <td>&#62;=</td>
                    </tr>
                    <tr>
                      <td>Raiz Cuadrada</td>
                      <td>&radic;</td>
                      <td>sqrt</td>
                    </tr>
                  </tbody>
                </table>

              </div>

            </section>

          </div>
          <!-- end project-detail sidebar -->

        </div>
      </div>
    </div>
  </div>

  <div id="variables_div" class="row filtrarRow">
    <div class="col-md-12">
      <div class="x_panel">
        <div class="x_title">
          <h2>Variables de Formula del Ratio de Cobertura de Liquidez</h2>
          <ul class="nav navbar-right panel_toolbox">
            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
            </li>
          </ul>
          <div class="clearfix"></div>
        </div>

        <div class="x_content">

          <div class="col-md-12 col-sm-12 col-xs-12">
            <h5>Para editar el campo, haga click en la celda de la fila y columna que desea editar.</h5>
            <h5>Para ver las variables asociadas con la variable de la formula, haga click en el bot&oacute;n verde de la primera columna.</h5>
            <h5>* Nota: Las variables son insensibles a may&uacute;sculas y min&uacute;sculas en la f&oacute;rmula.</h5>
            <h5>* Nota: Las variables no deben empezar con un n&uacute;mero, pero pueden llevar uno en medio o al final.</h5>
            <br/>

            <div class="card-box table-responsive">
              <table id="datatable_variables" class="table table-striped table-bordered">
                <thead>
                  <tr>
                    <th></th>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Variables</th>
                    <th>Descripci&oacute;n</th>
                    <th>Guardar</th>
                    <th>Eliminar</th>
                  </tr>
                </thead>

                <tbody>
                </tbody>
              </table>
            </div>

            <br/>

          </div>

        </div>
      </div>
    </div>
  </div> <!-- /end VARIABLES -->


  <div id="variablesDeVariables_div" class="row filtrarRow">
    <div class="col-md-12">
      <div class="x_panel">
        <div class="x_title">
          <h2>SubVariables de Formula del Ratio de Cobertura de Liquidez</h2>
          <ul class="nav navbar-right panel_toolbox">
            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
            </li>
          </ul>
          <div class="clearfix"></div>
        </div>

        <div class="x_content">

          <div class="col-md-12 col-sm-12 col-xs-12">
            <h5>Para editar el campo, haga click en la celda de la fila y columna que desea editar.</h5>
            <h5>* Nota: Las variables son insensibles a may&uacute;sculas y min&uacute;sculas en la f&oacute;rmula.</h5>
            <h5>* Nota: Las sub-variables no deben empezar con un n&uacute;mero, pero pueden llevar uno en medio o al final.</h5>
            <br/>

            <div class="card-box table-responsive">
              <table id="datatable_variablesOfVariables" class="table table-striped table-bordered">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Descripci&oacute;n</th>
                    <th>Factor</th>
                    <th>Tabla a Aplicar</th>
                    <th>Guardar</th>
                    <th>Eliminar</th>
                    <th>Editar Filtros</th>
                  </tr>
                </thead>

                <tbody id="datatable_variablesOfVariables_body">
                </tbody>
              </table>
            </div>

            <br/>

          </div>

        </div>
      </div>
    </div>
  </div>  <!-- /end VARIABLESDEVARIABLES -->

</div>
<!-- /page content -->

<!-- Datatables -->
<script src="src/libs/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="src/libs/datatables.net/js/jquery.dataTablesEditor.js"></script>
<script src="src/libs/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<script src="src/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="src/libs/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
<script src="src/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
<script src="src/libs/datatables.net-buttons/js/buttons.flash.min.js"></script>
<script src="src/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="src/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="src/libs/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
<script src="src/libs/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
<script src="src/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="src/libs/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
<script src="src/libs/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
<script src="src/libs/jszip/dist/jszip.min.js"></script>
<script src="src/libs/pdfmake/build/pdfmake.min.js"></script>
<script src="src/libs/pdfmake/build/vfs_fonts.js"></script>

<script src="src/libs/iCheck/icheck.min.js"></script>

<script src="src/libs/jquery.inputmask/dist/min/jquery.inputmask.bundle.min.js"></script>

<script src="src/libs/jquery-ui/jquery-ui.min.js"></script>

<script src="src/libs/overhang/overhang.min.js"></script>

<script src="src/libs/mathjs/math.js"></script>

<script src="src/libs/jquery.inputmask/dist/min/jquery.inputmask.bundle.min.js"></script>

<script src="src/libs/bootstrap-datepicker/bootstrap-datepicker.js"></script>

<script src="src/libs/bootstrap-datepicker/locales/bootstrap-datepicker.es.js"></script>

<script src="src/variables.js"></script>

<script src="src/libs/mathlive-master/dist/mathlive.js"></script>
<script > 
  var mathfield = MathLive.makeMathField('salida');
  function saveFormula () {
    var formula = mathfield.text();
    var resultado = '';
    for (var i = 0; i < formula.length; i++) {
      var tipo = '';
      if(formula.charAt(i) == '\\')
        tipo = getType(formula, i);
      else if( formula.charAt(i) == '{' )
        resultado+='(';
      else if( formula.charAt(i) == '}' )
        resultado+=')';
      else if( formula.charAt(i) == '(' )
        resultado+='(';
      else if( formula.charAt(i) == ')' )
        resultado+=')';
      else if( formula.charAt(i) != ' ' || formula.charAt(i) == '<' || formula.charAt(i) == '>' )/*if( !isNaN(formula.charAt(i)) )*/
        resultado+=formula.charAt(i);
      if(tipo.length>0){
        if(tipo == 'le')
          resultado+='<=';
        else if(tipo == 'ge')
          resultado+='>=';
        else if(tipo == 'ne')
          resultado+='!=';
        else if(tipo == 'frac')
          resultado+='/';
        else if(tipo == 'sqrt')
          resultado+='√';
        else if(tipo == 'times')
          resultado+='*';
        i+=tipo.length;
      }
    }
    var banderaPosiciones = [];
    for (var i = 0; i < resultado.length; i++) {
      var fraccion = '';
      if(resultado.charAt(i) == '/' && !banderaPosiciones[i]){
        var posNumerado = countPosFractioParenthes(resultado, i);
        banderaPosiciones[posNumerado] = true;
        resultado = [resultado.slice(0, i), resultado.slice(i+1, posNumerado+1), "/", resultado.slice(posNumerado+1) ].join('');
      }
    }
    verifyAndSaveFormula(resultado, formula);
  }

  function countPosFractioParenthes (cadena, pos) {
    var contadorFrac = 0;
    for (var i = pos+1; i < cadena.length; i++) {
      if( cadena.charAt(i) == '(' )
        contadorFrac++;
      else if( cadena.charAt(i) == ')' )
        contadorFrac--;
      if(contadorFrac == 0)
        return i;
    }
    return i;
  }

  function getType (formula, index) {
    var text = '';
    for (var i = index+1; i < formula.length; i++) {
      if( isNaN(formula.charAt(i)) && formula.charAt(i) != '{' && formula.charAt(i) != '(' && formula.charAt(i) != '}' && formula.charAt(i) != ')' && formula.charAt(i) != ' '){
        text+=formula.charAt(i);
      } else /*if( formula.charAt(i) == ' ' )*/
        break;
    }
    return text;
  }

  String.prototype.splice = function(idx, rem, str) {
    return this.slice(0, idx) + str + this.slice(idx + Math.abs(rem));
  };

  resetFormula();

  function resetFormula () {
    if(formulaMATHLIVEGlobal != null)
      $("#salida").text(formulaMATHLIVEGlobal);
    else
      $("#salida").text("f(x)");
    mathfield = MathLive.makeMathField('salida');
  }

</script>